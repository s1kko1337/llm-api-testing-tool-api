openapi: 3.0.0
info:
  title: LLM Testing Tool API
  description: API для системы тестирования LLM с аутентификацией, верификацией email и сбросом пароля
  version: 1.0.0
  contact:
    name: API Support

servers:
  - url: http://localhost:8000/api/v1
    description: Local development server
  - url: https://your-domain.com/api/v1
    description: Production server

tags:
  - name: Authentication
    description: Операции аутентификации (регистрация, логин, выход)
  - name: Email Verification
    description: Верификация email адреса
  - name: Password Reset
    description: Сброс и восстановление пароля

paths:
  /register:
    post:
      tags:
        - Authentication
      summary: Регистрация нового пользователя
      description: Создание нового аккаунта пользователя с автоматической генерацией токена
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
              properties:
                name:
                  type: string
                  minLength: 8
                  maxLength: 64
                  description: Имя пользователя
                  example: John Doe
                email:
                  type: string
                  format: email
                  minLength: 8
                  maxLength: 255
                  description: Email адрес (должен быть уникальным)
                  example: john.doe@example.com
                password:
                  type: string
                  format: password
                  minLength: 8
                  maxLength: 64
                  description: Пароль пользователя
                  example: SecurePass123
      responses:
        '201':
          description: Пользователь успешно зарегистрирован
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/User'
                  - type: object
                    properties:
                      token:
                        type: string
                        description: Bearer токен для аутентификации
                        example: 1|abcdefghijklmnopqrstuvwxyz123456
        '422':
          description: Ошибка валидации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /login:
    post:
      tags:
        - Authentication
      summary: Вход в систему
      description: Аутентификация пользователя по email и паролю
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  description: Email адрес пользователя
                  example: john.doe@example.com
                password:
                  type: string
                  format: password
                  description: Пароль пользователя
                  example: SecurePass123
      responses:
        '200':
          description: Успешная аутентификация
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/User'
                  - type: object
                    properties:
                      token:
                        type: string
                        description: Bearer токен для аутентификации
                        example: 2|xyz789abcdefghijklmnopqrstuvwx
        '401':
          description: Неверный email или пароль
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: Wrong email or password
        '422':
          description: Ошибка валидации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /logout:
    get:
      tags:
        - Authentication
      summary: Выход из системы
      description: Удаление текущего токена аутентификации
      operationId: logout
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Успешный выход
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logged out, token removed
        '401':
          $ref: '#/components/responses/Unauthorized'

  /forgot-password:
    post:
      tags:
        - Password Reset
      summary: Запрос на сброс пароля
      description: Отправка ссылки для сброса пароля на email пользователя
      operationId: forgotPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: Email адрес зарегистрированного пользователя
                  example: john.doe@example.com
      responses:
        '200':
          description: Ссылка для сброса пароля отправлена
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password reset link sent
                  status:
                    type: string
                    example: passwords.sent
        '422':
          description: Ошибка валидации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '500':
          description: Ошибка при отправке ссылки
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Failed to send password reset link
                  error:
                    type: string

  /reset-password/{token}:
    get:
      tags:
        - Password Reset
      summary: Автоматический сброс пароля по токену
      description: Автоматическая генерация нового пароля и отправка на email
      operationId: resetPasswordByToken
      parameters:
        - name: token
          in: path
          required: true
          description: Токен для сброса пароля из email
          schema:
            type: string
          example: abc123xyz789token
      responses:
        '200':
          description: Пароль успешно сброшен
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Пароль успешно сброшен. Новый пароль отправлен на вашу почту.
                  status:
                    type: string
                    example: passwords.reset
        '400':
          description: Недействительный токен
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Ошибка при сбросе пароля
                  error:
                    type: string
                    example: invalid_token
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Ошибка при сбросе пароля
                  error:
                    type: string

  /reset-password:
    post:
      tags:
        - Password Reset
      summary: Сброс пароля с указанием нового
      description: Установка нового пароля по токену из email
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - email
                - password
                - password_confirmation
              properties:
                token:
                  type: string
                  description: Токен для сброса пароля из email
                  example: abc123xyz789token
                email:
                  type: string
                  format: email
                  description: Email адрес пользователя
                  example: john.doe@example.com
                password:
                  type: string
                  format: password
                  minLength: 8
                  description: Новый пароль
                  example: NewSecurePass456
                password_confirmation:
                  type: string
                  format: password
                  description: Подтверждение нового пароля (должно совпадать с password)
                  example: NewSecurePass456
      responses:
        '200':
          description: Пароль успешно обновлен
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password updated successfully
                  status:
                    type: string
                    example: passwords.reset
        '422':
          description: Ошибка валидации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '500':
          description: Ошибка при обновлении пароля
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password update error
                  error:
                    type: string

  /email/verify/{id}/{hash}:
    get:
      tags:
        - Email Verification
      summary: Подтверждение email адреса
      description: Верификация email по ссылке из письма (подписанный URL)
      operationId: verifyEmail
      parameters:
        - name: id
          in: path
          required: true
          description: ID пользователя
          schema:
            type: integer
          example: 1
        - name: hash
          in: path
          required: true
          description: Хэш для верификации (подпись)
          schema:
            type: string
          example: abc123hash
        - name: expires
          in: query
          required: true
          description: Timestamp истечения ссылки
          schema:
            type: integer
          example: 1699999999
        - name: signature
          in: query
          required: true
          description: Подпись URL
          schema:
            type: string
          example: xyz789signature
      responses:
        '200':
          description: Email успешно подтвержден
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  verified:
                    type: boolean
                    example: true
        '403':
          description: Недействительная или истекшая ссылка
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid verification link
        '500':
          description: Ошибка при подтверждении email
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Произошла ошибка при подтверждении email.
                  verified:
                    type: boolean
                    example: false
                  error:
                    type: string

  /email/verify:
    get:
      tags:
        - Email Verification
      summary: Проверка статуса верификации email
      description: Получение информации о статусе верификации email текущего пользователя
      operationId: emailVerificationStatus
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Статус верификации получен
          content:
            application/json:
              schema:
                type: object
                properties:
                  verified:
                    type: boolean
                    description: Статус верификации email
                    example: true
                  message:
                    type: string
                    example: Email is verified
        '401':
          $ref: '#/components/responses/Unauthorized'

  /email/verification-notification:
    post:
      tags:
        - Email Verification
      summary: Повторная отправка письма для верификации
      description: Отправка нового письма с ссылкой для подтверждения email
      operationId: resendVerificationEmail
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Письмо отправлено
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Verification email sent
                  status:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Используйте Bearer токен, полученный при регистрации или логине

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          description: Уникальный идентификатор пользователя
          example: 1
        name:
          type: string
          description: Имя пользователя
          example: John Doe
        email:
          type: string
          format: email
          description: Email адрес пользователя
          example: john.doe@example.com
        roles:
          type: array
          description: Роли пользователя (доступно при загрузке связи)
          items:
            type: object
            properties:
              id:
                type: integer
                example: 1
              name:
                type: string
                example: user

    ValidationError:
      type: object
      properties:
        message:
          type: string
          example: The given data was invalid.
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
          example:
            email:
              - The email field is required.
              - The email must be a valid email address.
            password:
              - The password field is required.

  responses:
    Unauthorized:
      description: Не авторизован - требуется валидный Bearer токен
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: Unauthenticated.

security: []
